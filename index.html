<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»æ°—æŠµæŠ—ãƒã‚¹ã‚¿ãƒ¼ - å°ä½“ã¨çµ¶ç¸ä½“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap');

        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: #f0f9ff;
            touch-action: manipulation;
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾© */
        @keyframes flow {
            0% { stroke-dashoffset: 100; }
            100% { stroke-dashoffset: 0; }
        }

        @keyframes glow {
            0% { filter: drop-shadow(0 0 5px #ffd700); transform: scale(1); }
            50% { filter: drop-shadow(0 0 20px #ffd700); transform: scale(1.1); }
            100% { filter: drop-shadow(0 0 5px #ffd700); transform: scale(1); }
        }

        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* ã‚¯ãƒ©ã‚¹ */
        .circuit-path {
            fill: none;
            stroke: #333;
            stroke-width: 4;
            stroke-linecap: round;
        }

        .electron-flow {
            fill: none;
            stroke: #fbbf24; /* é»„è‰² */
            stroke-width: 6;
            stroke-dasharray: 10 5;
            animation: flow 1s linear infinite;
            display: none; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯éè¡¨ç¤º */
        }

        .bulb-off {
            fill: #e5e7eb;
            stroke: #9ca3af;
            stroke-width: 2;
            transition: all 0.3s ease;
        }

        .bulb-on {
            fill: #fbbf24;
            stroke: #f59e0b;
            animation: glow 1s infinite alternate;
        }

        .material-icon {
            font-size: 4rem;
            animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .btn-push {
            transition: transform 0.1s;
        }
        .btn-push:active {
            transform: scale(0.95);
        }

        /* ç´™å¹é›ªç”¨ */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            z-index: 100;
        }

        /* è§£èª¬ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="text-gray-800 min-h-screen flex flex-col items-center justify-center p-4">

    <!-- ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="bg-white rounded-3xl shadow-xl w-full max-w-lg overflow-hidden relative min-h-[600px] flex flex-col">
        
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="bg-blue-500 text-white p-4 flex justify-between items-center z-10">
            <h1 class="font-bold text-lg"><i class="fas fa-bolt mr-2"></i>é›»æ°—æŠµæŠ—ãƒã‚¹ã‚¿ãƒ¼</h1>
            <div class="flex items-center gap-3">
                <button id="bgm-btn" class="text-white hover:text-yellow-200 transition" onclick="toggleSound()">
                    <i class="fas fa-volume-up" id="sound-icon"></i>
                </button>
                <span class="bg-blue-700 px-3 py-1 rounded-full text-sm font-bold" id="score-display">0ç‚¹</span>
            </div>
        </header>

        <!-- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ -->
        <div id="title-screen" class="absolute inset-0 bg-white z-20 flex flex-col items-center justify-center p-6 text-center">
            <div class="mb-6 text-6xl text-yellow-400">
                <i class="fas fa-lightbulb animate-bounce"></i>
            </div>
            <h1 class="text-3xl font-extrabold text-blue-600 mb-2">é›»æ°—ã‚’é€šã™ï¼Ÿ<br>é€šã•ãªã„ï¼Ÿ</h1>
            <p class="text-gray-500 mb-8">å°ä½“ã¨çµ¶ç¸ä½“ã‚’è¦‹æ¥µã‚ã‚ˆã†ï¼</p>
            
            <div class="bg-blue-50 p-4 rounded-xl mb-8 text-left text-sm">
                <h3 class="font-bold mb-2 text-blue-700">ãƒ«ãƒ¼ãƒ«èª¬æ˜</h3>
                <ul class="list-disc list-inside space-y-1 text-gray-700">
                    <li>è¡¨ç¤ºã•ã‚Œã‚‹ç‰©è³ªãŒé›»æ°—ã‚’é€šã™ã‹äºˆæƒ³ã—ã¦ã­</li>
                    <li>æ­£è§£ã™ã‚‹ã¨é›»çƒãŒå…‰ã‚‹ã‚ˆï¼</li>
                    <li>å…¨15å•ã€ç›®æŒ‡ã›é›»æ°—ãƒã‚¹ã‚¿ãƒ¼ï¼</li>
                </ul>
            </div>

            <button onclick="startGame()" class="btn-push bg-yellow-400 hover:bg-yellow-500 text-white text-xl font-bold py-4 px-12 rounded-full shadow-lg transform transition w-full max-w-xs border-b-4 border-yellow-600">
                ã‚¹ã‚¿ãƒ¼ãƒˆï¼
            </button>
        </div>

        <!-- ã‚¯ã‚¤ã‚ºç”»é¢ -->
        <div id="game-screen" class="flex-1 flex flex-col relative hidden">
            <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ -->
            <div class="w-full bg-gray-200 h-2">
                <div id="progress-bar" class="bg-green-400 h-2 transition-all duration-300" style="width: 0%"></div>
            </div>

            <!-- å•é¡Œç•ªå· -->
            <div class="text-center mt-2 text-gray-500 font-bold text-sm">
                ç¬¬ <span id="current-q-num">1</span> å• / å…¨ 15 å•
            </div>

            <!-- å›è·¯å›³ã‚¨ãƒªã‚¢ (Canvas/SVG) -->
            <div class="relative h-48 w-full bg-gray-50 flex items-center justify-center border-b border-gray-100">
                <svg width="300" height="180" viewBox="0 0 300 180" class="w-full h-full">
                    <!-- å›è·¯ã®ãƒ‘ã‚¹ -->
                    <path d="M 50 90 L 50 150 L 250 150 L 250 90" class="circuit-path" />
                    <path d="M 50 50 L 50 30 L 110 30" class="circuit-path" /> <!-- å·¦ä¸Š -->
                    <path d="M 190 30 L 250 30 L 250 50" class="circuit-path" /> <!-- å³ä¸Š -->
                    
                    <!-- é›»æµã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ãƒ‘ã‚¹ (é€šå¸¸éè¡¨ç¤º) -->
                    <path id="flow-anim-left" d="M 50 50 L 50 30 L 110 30" class="electron-flow" />
                    <path id="flow-anim-right" d="M 190 30 L 250 30 L 250 90" class="electron-flow" />
                    <path id="flow-anim-bottom" d="M 250 90 L 250 150 L 50 150 L 50 90" class="electron-flow" />

                    <!-- é›»æ±  -->
                    <g transform="translate(30, 50)">
                        <rect x="0" y="0" width="40" height="40" fill="#ddd" rx="4" />
                        <rect x="10" y="5" width="20" height="30" fill="#3b82f6" />
                        <text x="20" y="25" text-anchor="middle" fill="white" font-size="12" font-weight="bold">é›»æ± </text>
                        <text x="20" y="-5" text-anchor="middle" fill="#333" font-size="14" font-weight="bold">+</text>
                    </g>

                    <!-- é›»çƒ -->
                    <g transform="translate(230, 50)">
                        <path id="bulb-glass" class="bulb-off" d="M 10 0 C -10 0 -15 15 -10 25 L -5 35 L 25 35 L 30 25 C 35 15 30 0 10 0 Z" transform="translate(10, 0)" />
                        <rect x="15" y="35" width="10" height="10" fill="#666" />
                    </g>

                    <!-- ãƒ†ã‚¹ãƒˆé ˜åŸŸï¼ˆç‰©è³ªé…ç½®å ´æ‰€ï¼‰ -->
                    <g transform="translate(150, 30)">
                        <circle cx="0" cy="0" r="5" fill="#ef4444" />
                        <circle cx="-40" cy="0" r="3" fill="#333" />
                        <circle cx="40" cy="0" r="3" fill="#333" />
                        <text x="0" y="-15" text-anchor="middle" fill="#666" font-size="10">ã“ã“ã«ç‰©è³ªã‚’ã‚»ãƒƒãƒˆ</text>
                    </g>
                </svg>
            </div>

            <!-- å‡ºé¡Œã‚¨ãƒªã‚¢ -->
            <div class="flex-1 flex flex-col items-center justify-center p-4">
                <div class="mb-4 text-center">
                    <div id="q-image" class="material-icon mb-4">ğŸ</div>
                    <h2 id="q-name" class="text-2xl font-bold text-gray-800">ç‰©è³ªå</h2>
                </div>
                
                <p class="text-lg font-bold text-blue-600 mb-6">é›»æ°—ã‚’é€šã™ï¼Ÿ</p>

                <!-- ãƒ’ãƒ³ãƒˆã‚¨ãƒªã‚¢ -->
                <div id="hint-area" class="w-full max-w-sm mb-4 hidden">
                    <div class="bg-yellow-50 border border-yellow-200 p-3 rounded-lg text-sm text-yellow-800 flex items-start">
                        <i class="fas fa-lightbulb text-yellow-500 mt-1 mr-2"></i>
                        <span id="hint-text">ãƒ’ãƒ³ãƒˆãƒ†ã‚­ã‚¹ãƒˆ</span>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 w-full max-w-sm">
                    <button onclick="checkAnswer(true)" class="btn-push bg-red-500 hover:bg-red-600 text-white font-bold py-4 rounded-xl shadow-md border-b-4 border-red-700 flex flex-col items-center">
                        <i class="fas fa-bolt text-2xl mb-1"></i>
                        é€šã™
                    </button>
                    <button onclick="checkAnswer(false)" class="btn-push bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 rounded-xl shadow-md border-b-4 border-blue-700 flex flex-col items-center">
                        <i class="fas fa-times-circle text-2xl mb-1"></i>
                        é€šã•ãªã„
                    </button>
                </div>
                
                <button onclick="showHint()" class="mt-4 text-sm text-gray-400 underline hover:text-blue-500">ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹</button>
            </div>
        </div>

        <!-- çµæœè¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="feedback-modal" class="modal-overlay absolute inset-0 z-50 hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 text-center transform transition-all scale-100">
                <div id="feedback-icon" class="text-6xl mb-4"></div>
                <h2 id="feedback-title" class="text-2xl font-black mb-2"></h2>
                
                <div class="bg-gray-50 rounded-lg p-4 text-left mb-6 border border-gray-100">
                    <div class="flex items-center mb-2">
                        <span id="feedback-type" class="text-xs font-bold px-2 py-1 rounded text-white bg-gray-500 mr-2">åˆ†é¡</span>
                        <span class="font-bold text-gray-800" id="feedback-item-name">ç‰©è³ªå</span>
                    </div>
                    <p id="feedback-desc" class="text-sm text-gray-600 leading-relaxed"></p>
                </div>

                <button id="next-btn" onclick="nextQuestion()" class="btn-push bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full shadow-lg w-full">
                    æ¬¡ã¸é€²ã‚€
                </button>
            </div>
        </div>

        <!-- æœ€çµ‚çµæœç”»é¢ -->
        <div id="result-screen" class="absolute inset-0 bg-white z-20 hidden flex flex-col p-6 overflow-y-auto">
            <div class="text-center mt-8 mb-6">
                <h2 class="text-2xl font-bold text-gray-700 mb-2">çµæœç™ºè¡¨ï¼</h2>
                <div class="text-5xl font-black text-blue-600 mb-2">
                    <span id="final-score">0</span><span class="text-2xl text-gray-400">/15</span>
                </div>
                <div id="rank-badge" class="inline-block bg-yellow-400 text-white text-lg font-bold px-4 py-1 rounded-full shadow mb-2">
                    ãƒ©ãƒ³ã‚¯
                </div>
                <p id="rank-comment" class="text-gray-600 font-bold">ã‚³ãƒ¡ãƒ³ãƒˆ</p>
            </div>

            <!-- å¾©ç¿’ãƒªã‚¹ãƒˆ -->
            <div class="flex-1 mb-6">
                <h3 class="text-left font-bold text-gray-700 border-b-2 border-gray-100 pb-2 mb-4">
                    <i class="fas fa-book-open text-blue-500 mr-2"></i>å¾©ç¿’ã—ã‚ˆã†
                </h3>
                <div id="review-list" class="space-y-3">
                    <!-- é–“é•ãˆãŸå•é¡ŒãŒã“ã“ã«æŒ¿å…¥ã•ã‚Œã‚‹ -->
                </div>
                <div id="perfect-message" class="hidden text-center p-8 bg-yellow-50 rounded-xl border border-yellow-200">
                    <i class="fas fa-crown text-4xl text-yellow-500 mb-2"></i>
                    <p class="font-bold text-yellow-700">å…¨å•æ­£è§£ï¼ç´ æ™´ã‚‰ã—ã„ï¼</p>
                </div>
            </div>

            <button onclick="initGame()" class="btn-push bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg mb-4">
                ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã™ã‚‹
            </button>
        </div>

    </div>

    <script>
        // --- ãƒ‡ãƒ¼ã‚¿å®šç¾© ---
        const quizData = [
            // é‡‘å± (å°ä½“)
            { id: 1, name: "éŠ…ç·š", type: "conductor", category: "é‡‘å± (å°ä½“)", explanation: "éŠ…ãªã©ã®é‡‘å±ã®ä¸­ã«ã¯ã€Œè‡ªç”±é›»å­ã€ãŒã‚ã‚Šã€ã“ã‚ŒãŒè‡ªç”±ã«å‹•ãã“ã¨ã§é›»æ°—ã‚’é‹ã³ã¾ã™ã€‚é›»ç·šã«ã‚ˆãä½¿ã‚ã‚Œã¾ã™ã€‚", emoji: "ğŸ”Œ", hint: "é›»ç·šã®ä¸­èº«ã«ä½¿ã‚ã‚Œã¦ã„ã‚‹èŒ¶è‰²ã®é‡‘å±ã ã‚ˆã€‚" },
            { id: 2, name: "ã‚¢ãƒ«ãƒŸãƒ›ã‚¤ãƒ«", type: "conductor", category: "é‡‘å± (å°ä½“)", explanation: "ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ã‚‚é‡‘å±ãªã®ã§ã€é›»æ°—ã‚’ã‚ˆãé€šã—ã¾ã™ã€‚å®Ÿé¨“ã§å›è·¯ã‚’ä½œã‚‹ã¨ãã«ã‚‚ä½¿ãˆã¾ã™ã€‚", emoji: "ğŸŒ¯", hint: "ãŠå¼å½“ã‚„ãŠã«ãã‚Šã‚’åŒ…ã‚€ã‚­ãƒ©ã‚­ãƒ©ã—ãŸã‚·ãƒ¼ãƒˆã ã‚ˆã€‚" },
            { id: 3, name: "é‰„ã®ã‚¯ã‚®", type: "conductor", category: "é‡‘å± (å°ä½“)", explanation: "é‰„ã¯é‡‘å±ã§ã™ã€‚éŠ…ã»ã©é€šã‚Šã‚„ã™ãã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€é›»æ°—ã‚’é€šã™å°ä½“ã§ã™ã€‚", emoji: "ğŸ”©", hint: "ç£çŸ³ã«ãã£ã¤ãã€ç¡¬ã„é‡‘å±ã ã‚ˆã€‚" },
            { id: 4, name: "é‡‘ã®æŒ‡è¼ª", type: "conductor", category: "é‡‘å± (å°ä½“)", explanation: "é‡‘ã¯ã¨ã¦ã‚‚é›»æ°—ã‚’é€šã—ã‚„ã™ã„é‡‘å±ã§ã™ã€‚éŒ†ã³ã«ãã„ã®ã§ã€ã‚¹ãƒãƒ›ã‚„ãƒ‘ã‚½ã‚³ãƒ³ã®å¤§äº‹ãªéƒ¨å“ã«ã‚‚ä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚", emoji: "ğŸ’", hint: "ç‹å† ã‚„ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ã«ä½¿ã‚ã‚Œã‚‹ã€é«˜ä¾¡ã§ãƒ”ã‚«ãƒ”ã‚«ã—ãŸé‡‘å±ã ã‚ˆã€‚" },
            { id: 5, name: "10å††ç‰", type: "conductor", category: "é‡‘å± (å°ä½“)", explanation: "10å††ç‰ã¯ã€Œé’éŠ…ã€ã¨ã„ã†éŠ…ã®åˆé‡‘ã§ã§ãã¦ã„ã¾ã™ã€‚é‡‘å±ãªã®ã§é›»æ°—ã‚’é€šã—ã¾ã™ã€‚", emoji: "ğŸ’°", hint: "èŒ¶è‰²ã„ç¡¬è²¨ã ã‚ˆã€‚ææ–™ã¯éŠ…ã ã­ã€‚" },
            // éé‡‘å±ã®å°ä½“
            { id: 6, name: "é‰›ç­†ã®èŠ¯", type: "conductor", category: "å°ä½“ (éé‡‘å±)", explanation: "é‰›ç­†ã®èŠ¯ã¯ã€Œé»’é‰›ï¼ˆã“ããˆã‚“ï¼‰ã€ã¨ã„ã†ç‚­ç´ ã®ä»²é–“ã§ã§ãã¦ã„ã¾ã™ã€‚é‡‘å±ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€é›»æ°—ã‚’é€šã™ç‰¹åˆ¥ãªæ€§è³ªãŒã‚ã‚Šã¾ã™ã€‚", emoji: "âœï¸", hint: "æœ¨ã®éƒ¨åˆ†ã¯é›»æ°—ã‚’é€šã•ãªã„ã‘ã©ã€æ›¸ãé»’ã„éƒ¨åˆ†ã¯â€¦ï¼Ÿ" },
            { id: 7, name: "äººé–“ã®ä½“", type: "conductor", category: "å°ä½“ (å¼±)", explanation: "äººé–“ã®ä½“ã«ã¯æ°´åˆ†ã‚„å¡©åˆ†ãªã©ãŒå«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€é›»æ°—ã‚’é€šã—ã¾ã™ã€‚ã ã‹ã‚‰æ„Ÿé›»ã«ã¯æ³¨æ„ãŒå¿…è¦ã§ã™ï¼", emoji: "ğŸ§", hint: "ã‚‚ã—é›»æ°—ãŒé€šã‚‰ãªã‹ã£ãŸã‚‰ã€æ„Ÿé›»ã‚‚ã—ãªã„ã¯ãšã ã‘ã©â€¦ï¼Ÿ" },
            { id: 8, name: "é£Ÿå¡©æ°´", type: "conductor", category: "å°ä½“ (æ¶²ä½“)", explanation: "æ°´ã«é£Ÿå¡©ãŒæº¶ã‘ã‚‹ã¨ã€Œã‚¤ã‚ªãƒ³ã€ã¨ã„ã†é›»æ°—ã‚’é‹ã¶ç²’ãŒã§ãã¾ã™ã€‚ãŸã ã®æ°´ã¯é›»æ°—ã‚’é€šã—ã«ãã„ã§ã™ãŒã€é£Ÿå¡©æ°´ã¯é€šã—ã¾ã™ã€‚", emoji: "ğŸ§‚ğŸ’§", hint: "çœŸæ°´ã¯é€šã—ã«ãã„ã‘ã©ã€å¡©ãŒæº¶ã‘ã‚‹ã¨ã‚¤ã‚ªãƒ³ãŒã§ãã‚‹ã‚ˆã€‚" },
            // çµ¶ç¸ä½“
            { id: 9, name: "ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯ã®å®šè¦", type: "insulator", category: "çµ¶ç¸ä½“", explanation: "ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯ã«ã¯è‡ªç”±ã«å‹•ã‘ã‚‹é›»å­ãŒã»ã¨ã‚“ã©ãªã„ãŸã‚ã€é›»æ°—ã‚’é€šã—ã¾ã›ã‚“ã€‚ã‚³ãƒ³ã‚»ãƒ³ãƒˆã®ã‚«ãƒãƒ¼ãªã©ã«ä½¿ã‚ã‚Œã¾ã™ã€‚", emoji: "ğŸ“", hint: "è»½ãã¦ä¾¿åˆ©ã€‚ç­†ç®±ã«å…¥ã£ã¦ã„ã‚‹é€æ˜ãªé“å…·ã ã‚ˆã€‚" },
            { id: 10, name: "è¼ªã‚´ãƒ ", type: "insulator", category: "çµ¶ç¸ä½“", explanation: "ã‚´ãƒ ã¯ä»£è¡¨çš„ãªçµ¶ç¸ä½“ï¼ˆãœã¤ãˆã‚“ãŸã„ï¼‰ã§ã™ã€‚é›»æ°—ã‚’é€šã•ãªã„ã®ã§ã€é›»ç·šã®è¢«è¦†ï¼ˆã‚«ãƒãƒ¼ï¼‰ã«ä½¿ã‚ã‚Œã¾ã™ã€‚", emoji: "ğŸ€", hint: "ä¼¸ã°ã™ã¨ç¸®ã‚€ã‚ˆã€‚é›»ç·šã®ã‚«ãƒãƒ¼ã«ã‚‚ä½¿ã‚ã‚Œã¦ã„ã‚‹ç´ æã ã­ã€‚" },
            { id: 11, name: "ã‚¬ãƒ©ã‚¹ã®ã‚³ãƒƒãƒ—", type: "insulator", category: "çµ¶ç¸ä½“", explanation: "ã‚¬ãƒ©ã‚¹ã¯é›»æ°—ã‚’é€šã—ã¾ã›ã‚“ã€‚æ˜”ã®é›»æŸ±ã«ã¯ã€é›»ç·šãŒæŸ±ã«è§¦ã‚Œãªã„ã‚ˆã†ã«ã‚¬ãƒ©ã‚¹ã‚„é™¶å™¨ã®éƒ¨å“ãŒä½¿ã‚ã‚Œã¦ã„ã¾ã—ãŸã€‚", emoji: "ğŸ¥›", hint: "é€æ˜ã§å‰²ã‚Œã‚„ã™ã„ã€‚çª“ã‚¬ãƒ©ã‚¹ã¨åŒã˜ç´ æã ã‚ˆã€‚" },
            { id: 12, name: "ä¹¾ã„ãŸæœ¨æ", type: "insulator", category: "çµ¶ç¸ä½“", explanation: "ä¹¾ç‡¥ã—ãŸæœ¨ã¯é›»æ°—ã‚’é€šã—ã¾ã›ã‚“ã€‚ãŸã ã—ã€æ°´ã§æ¿¡ã‚Œã‚‹ã¨æ°´åˆ†ãŒé›»æ°—ã‚’é€šã™ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚", emoji: "ğŸªµ", hint: "æ£®ã«ã‚ã‚‹æœ¨ã ã‚ˆã€‚æ¿¡ã‚Œã¦ã„ãªã„çŠ¶æ…‹ã‚’æƒ³åƒã—ã¦ã­ã€‚" },
            { id: 13, name: "ãƒãƒ¼ãƒˆã®ç´™", type: "insulator", category: "çµ¶ç¸ä½“", explanation: "ç´™ã¯æœ¨ã®ç¹Šç¶­ã‹ã‚‰ã§ãã¦ãŠã‚Šã€ä¹¾ã„ã¦ã„ã‚Œã°é›»æ°—ã‚’é€šã—ã¾ã›ã‚“ã€‚", emoji: "ğŸ“„", hint: "æ•™ç§‘æ›¸ã‚„ãƒãƒ¼ãƒˆã«ä½¿ã‚ã‚Œã¦ã„ã‚‹ç´ æã ã‚ˆã€‚" },
            { id: 14, name: "é™¶å™¨ã®ãŠçš¿", type: "insulator", category: "çµ¶ç¸ä½“", explanation: "é™¶å™¨ï¼ˆã‚»ãƒ©ãƒŸãƒƒã‚¯ã‚¹ï¼‰ã¯é›»æ°—ã‚’é€šã—ã¾ã›ã‚“ã€‚é«˜åœ§é›»ç·šã®ã€ŒãŒã„ã—ã€ã¨ã„ã†éƒ¨å“ã«ã‚‚ä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚", emoji: "ğŸ½ï¸", hint: "é£Ÿäº‹ã«ä½¿ã†ãŠçš¿ã‚„èŒ¶ç¢—ã€‚è½ã¨ã™ã¨å‰²ã‚Œã¡ã‚ƒã†ã‚ˆã€‚" },
            { id: 15, name: "ç©ºæ°—", type: "insulator", category: "çµ¶ç¸ä½“", explanation: "é€šå¸¸ã®ç©ºæ°—ã¯é›»æ°—ã‚’é€šã—ã¾ã›ã‚“ã€‚ã‚‚ã—ç©ºæ°—ãŒé›»æ°—ã‚’é€šã—ãŸã‚‰ã€ã‚³ãƒ³ã‚»ãƒ³ãƒˆã‹ã‚‰é›»æ°—ãŒæ¼ã‚Œã¦å¤§å¤‰ãªã“ã¨ã«ãªã‚Šã¾ã™ï¼(é›·ãªã©ã®é«˜é›»åœ§ã¯åˆ¥ã§ã™)", emoji: "â˜ï¸", hint: "ç§ãŸã¡ã®å‘¨ã‚Šã«ã‚ã‚‹é€æ˜ãªæ°—ä½“ã ã‚ˆã€‚" }
        ];

        // --- ã‚²ãƒ¼ãƒ çŠ¶æ…‹å¤‰æ•° ---
        let currentQuestions = [];
        let currentIndex = 0;
        let score = 0;
        let wrongAnswers = [];
        let isSoundOn = true;
        
        // --- éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ« (ç°¡æ˜“çš„ãªã‚·ãƒ³ã‚»ã‚µã‚¤ã‚¶ãƒ¼éŸ³) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playTone(freq, type, duration) {
            if (!isSoundOn) return;
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãŒãªã„ã¨AudioContextãŒSuspendedã«ãªã‚‹å¯¾ç­–
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playSound(type) {
            if (type === 'correct') {
                playTone(880, 'sine', 0.1); // é«˜ã„éŸ³
                setTimeout(() => playTone(1760, 'sine', 0.2), 100);
            } else if (type === 'wrong') {
                playTone(150, 'sawtooth', 0.3); // ä½ã„ãƒ–ãƒ¼éŸ³
            } else if (type === 'click') {
                playTone(400, 'sine', 0.05);
            }
        }

        function toggleSound() {
            isSoundOn = !isSoundOn;
            const icon = document.getElementById('sound-icon');
            if (isSoundOn) {
                icon.className = "fas fa-volume-up";
            } else {
                icon.className = "fas fa-volume-mute";
            }
        }

        // --- ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ ---

        function shuffle(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        function initGame() {
            currentQuestions = shuffle([...quizData]); // ã‚³ãƒ”ãƒ¼ã—ã¦ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            currentIndex = 0;
            score = 0;
            wrongAnswers = [];
            
            document.getElementById('score-display').innerText = "0ç‚¹";
            document.getElementById('title-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            loadQuestion();
        }

        function startGame() {
            playSound('click');
            initGame();
        }

        function loadQuestion() {
            const q = currentQuestions[currentIndex];
            
            // UIãƒªã‚»ãƒƒãƒˆ
            document.getElementById('current-q-num').innerText = currentIndex + 1;
            document.getElementById('progress-bar').style.width = `${(currentIndex / 15) * 100}%`;
            document.getElementById('q-name').innerText = q.name;
            document.getElementById('q-image').innerText = q.emoji;
            document.getElementById('hint-area').classList.add('hidden');
            
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒªã‚»ãƒƒãƒˆ
            resetCircuit();
        }

        function resetCircuit() {
            document.getElementById('bulb-glass').setAttribute('class', 'bulb-off');
            document.querySelectorAll('.electron-flow').forEach(el => el.style.display = 'none');
        }

        function showHint() {
            const q = currentQuestions[currentIndex];
            document.getElementById('hint-text').innerText = q.hint;
            document.getElementById('hint-area').classList.remove('hidden');
        }

        function checkAnswer(userSaysConductor) {
            const q = currentQuestions[currentIndex];
            const isActuallyConductor = (q.type === 'conductor');
            const isCorrect = (userSaysConductor === isActuallyConductor);

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
            if (isActuallyConductor) {
                // å°ä½“ãªã‚‰é›»æµãŒæµã‚Œã‚‹
                document.querySelectorAll('.electron-flow').forEach(el => el.style.display = 'block');
                setTimeout(() => {
                    document.getElementById('bulb-glass').setAttribute('class', 'bulb-on');
                }, 500); // å°‘ã—é…ã‚Œã¦å…‰ã‚‹
            } else {
                // çµ¶ç¸ä½“ãªã‚‰ä½•ã‚‚ã—ãªã„ï¼ˆæš—ã„ã¾ã¾ï¼‰
            }

            if (isCorrect) {
                score++;
                playSound('correct');
                document.getElementById('score-display').innerText = score + "ç‚¹";
                fireConfetti();
                showFeedback(true, q);
            } else {
                playSound('wrong');
                wrongAnswers.push(q);
                showFeedback(false, q);
            }
        }

        function showFeedback(isCorrect, question) {
            const modal = document.getElementById('feedback-modal');
            const icon = document.getElementById('feedback-icon');
            const title = document.getElementById('feedback-title');
            const type = document.getElementById('feedback-type');
            const desc = document.getElementById('feedback-desc');
            const itemName = document.getElementById('feedback-item-name');

            modal.classList.remove('hidden');
            
            if (isCorrect) {
                icon.innerHTML = "â­•";
                icon.className = "text-6xl mb-4 text-green-500 animate-bounce";
                title.innerText = "æ­£è§£ï¼";
                title.className = "text-2xl font-black mb-2 text-green-600";
            } else {
                icon.innerHTML = "âŒ";
                icon.className = "text-6xl mb-4 text-red-500";
                title.innerText = "æ®‹å¿µ...";
                title.className = "text-2xl font-black mb-2 text-red-600";
            }

            // è§£èª¬ã‚»ãƒƒãƒˆ
            itemName.innerText = question.name;
            type.innerText = question.category;
            
            if (question.type === 'conductor') {
                type.className = "text-xs font-bold px-2 py-1 rounded text-white bg-red-500 mr-2";
            } else {
                type.className = "text-xs font-bold px-2 py-1 rounded text-white bg-blue-500 mr-2";
            }
            
            desc.innerText = question.explanation;
        }

        function nextQuestion() {
            playSound('click');
            document.getElementById('feedback-modal').classList.add('hidden');
            
            currentIndex++;
            if (currentIndex < 15) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            
            document.getElementById('final-score').innerText = score;
            
            const rankBadge = document.getElementById('rank-badge');
            const rankComment = document.getElementById('rank-comment');
            
            if (score >= 13) {
                rankBadge.innerText = "é›»æ°—ãƒã‚¹ã‚¿ãƒ¼";
                rankBadge.className = "inline-block bg-yellow-400 text-white text-lg font-bold px-4 py-1 rounded-full shadow mb-2";
                rankComment.innerText = "ã™ã”ã„ï¼é›»æ°—ã®æ€§è³ªã‚’å®Œç’§ã«ç†è§£ã—ã¦ã„ã‚‹ã­ï¼";
            } else if (score >= 10) {
                rankBadge.innerText = "ã‚ˆãã§ãã¾ã—ãŸ";
                rankBadge.className = "inline-block bg-green-400 text-white text-lg font-bold px-4 py-1 rounded-full shadow mb-2";
                rankComment.innerText = "ã‹ãªã‚Šã®æ­£è§£ç‡ï¼ã‚ã¨å°‘ã—ã§ãƒã‚¹ã‚¿ãƒ¼ã ï¼";
            } else if (score >= 7) {
                rankBadge.innerText = "ã‚‚ã†å°‘ã—";
                rankBadge.className = "inline-block bg-blue-400 text-white text-lg font-bold px-4 py-1 rounded-full shadow mb-2";
                rankComment.innerText = "èº«è¿‘ãªå°ä½“ã¨çµ¶ç¸ä½“ã®é•ã„ã‚’å¾©ç¿’ã—ã¦ã¿ã‚ˆã†ã€‚";
            } else {
                rankBadge.innerText = "å¾©ç¿’ãŒå¿…è¦";
                rankBadge.className = "inline-block bg-gray-400 text-white text-lg font-bold px-4 py-1 rounded-full shadow mb-2";
                rankComment.innerText = "é‡‘å±ã¯é›»æ°—ã‚’é€šã™ã‚ˆã€‚ã‚‚ã†ä¸€åº¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã‚ˆã†ï¼";
            }

            // å¾©ç¿’ãƒªã‚¹ãƒˆç”Ÿæˆ
            const reviewList = document.getElementById('review-list');
            reviewList.innerHTML = "";
            
            if (wrongAnswers.length === 0) {
                document.getElementById('perfect-message').classList.remove('hidden');
            } else {
                document.getElementById('perfect-message').classList.add('hidden');
                wrongAnswers.forEach(q => {
                    const item = document.createElement('div');
                    item.className = "bg-red-50 p-3 rounded-lg border border-red-100";
                    item.innerHTML = `
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-bold text-gray-800">
                                ${q.emoji} ${q.name}
                            </span>
                            <span class="text-xs px-2 py-1 rounded text-white ${q.type === 'conductor' ? 'bg-red-400' : 'bg-blue-400'}">
                                æ­£è§£: ${q.type === 'conductor' ? 'é€šã™' : 'é€šã•ãªã„'}
                            </span>
                        </div>
                        <p class="text-xs text-gray-600">${q.explanation}</p>
                    `;
                    reviewList.appendChild(item);
                });
            }
        }

        // --- ç´™å¹é›ªã‚¨ãƒ•ã‚§ã‚¯ãƒˆ (ç°¡æ˜“ç‰ˆ) ---
        function fireConfetti() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff'];
            for (let i = 0; i < 30; i++) {
                const conf = document.createElement('div');
                conf.className = 'confetti';
                conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.top = '-10px';
                conf.style.transform = `rotate(${Math.random() * 360}deg)`;
                document.body.appendChild(conf);

                const animation = conf.animate([
                    { top: '-10px', opacity: 1 },
                    { top: '100vh', opacity: 0, transform: `rotate(${Math.random() * 720}deg)` }
                ], {
                    duration: 1500 + Math.random() * 1000,
                    easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                });

                animation.onfinish = () => conf.remove();
            }
        }
    </script>
</body>
</html>